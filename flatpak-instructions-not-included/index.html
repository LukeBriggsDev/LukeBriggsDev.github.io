<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>Flatpak: Instructions Not Included - Luke Briggs</title><meta name="Description" content="How German Laser Beams Fixed My App"><meta property="og:title" content="Flatpak: Instructions Not Included" />
<meta property="og:description" content="How German Laser Beams Fixed My App" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.lukebriggs.dev/flatpak-instructions-not-included/" />
<meta property="og:image" content="https://www.lukebriggs.dev/banner.png"/>
<meta property="article:published_time" content="2021-05-22T19:08:56+01:00" />
<meta property="article:modified_time" content="2021-05-22T19:08:56+01:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://www.lukebriggs.dev/banner.png"/>

<meta name="twitter:title" content="Flatpak: Instructions Not Included"/>
<meta name="twitter:description" content="How German Laser Beams Fixed My App"/>
<meta name="application-name" content="Luke Briggs">
<meta name="apple-mobile-web-app-title" content="Luke Briggs"><meta name="theme-color" content="#4b4b4b"><meta name="msapplication-TileColor" content="#da532c"><link rel="icon" href="/LogoSimple.svg"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://www.lukebriggs.dev/flatpak-instructions-not-included/" /><link rel="prev" href="https://www.lukebriggs.dev/where-hugo-i-go/" /><link rel="stylesheet" href="/lib/normalize/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Flatpak: Instructions Not Included",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/www.lukebriggs.dev\/flatpak-instructions-not-included\/"
        },"genre": "posts","wordcount":  2453 ,
        "url": "https:\/\/www.lukebriggs.dev\/flatpak-instructions-not-included\/","datePublished": "2021-05-22T19:08:56+01:00","dateModified": "2021-05-22T19:08:56+01:00","publisher": {
            "@type": "Organization",
            "name": "Luke Briggs","logo": "https:\/\/www.lukebriggs.dev\/LogoFull.png"},"author": {
                "@type": "Person",
                "name": "Luke Briggs"
            },"description": "How German Laser Beams Fixed My App"
    }
    </script></head>
    <body header-desktop="fixed" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Luke Briggs"><span class="header-title-pre"><img src="/LogoSimple.svg" title="Home" width="24px" /a></span>Luke Briggs</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/projects/" title="Projects"> Projects </a><a class="menu-item" href="/categories/"> Categories </a><a class="menu-item" href="/about/" title="About"> About </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Luke Briggs"><span class="header-title-pre"><img src="/LogoSimple.svg" title="Home" width="24px" /a></span>Luke Briggs</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/projects/" title="Projects">Projects</a><a class="menu-item" href="/categories/" title="">Categories</a><a class="menu-item" href="/about/" title="About">About</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">Flatpak: Instructions Not Included</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Luke Briggs</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-05-22">2021-05-22</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;2453 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;12 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/static/postimages/flatpak-instructions-not-included/flatpak.svg"
        data-srcset="/static/postimages/flatpak-instructions-not-included/flatpak.svg, /static/postimages/flatpak-instructions-not-included/flatpak.svg 1.5x, /static/postimages/flatpak-instructions-not-included/flatpak.svg 2x"
        data-sizes="auto"
        alt="/static/postimages/flatpak-instructions-not-included/flatpak.svg"
        title="How German Laser Beams Fixed My App" /></div><div class="details toc" id="toc-static"  kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#context">Context</a></li>
    <li><a href="#python-deployment">Python Deployment</a></li>
    <li><a href="#linux-binary-woes">Linux Binary Woes</a>
      <ul>
        <li><a href="#build-systems">Build Systems</a></li>
        <li><a href="#flatpak">Flatpak</a>
          <ul>
            <li><a href="#the-trouble-with-python-qt-and-flatpak">The Trouble with Python, Qt and Flatpak</a></li>
          </ul>
        </li>
        <li><a href="#lasers-to-the-rescue">Lasers to the rescue</a></li>
      </ul>
    </li>
    <li><a href="#further-reading">Further Reading</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>There is a very peculiar thing I have found in software development, it is incredibly difficult to actually get software on other people&rsquo;s machines. Even compiled languages can have difficulty.</p>
<h2 id="context">Context</h2>
<p>I am elbow deep in a very large personal project at the moment (all will be revealed soon) that has so far taken a month. The project is getting to a stage now where deployment methods have to be evaluated. From the beginning I wanted the project to be fully cross platform across Windows, Linux, Mac with a singular codebase. Because of these specific requirements, I went with the <a href="https://www.qt.io/product/framework" target="_blank" rel="noopener noreffer">Qt GUI framework</a>, it is cross platform, runs natively on each platform, and has bindings for Python (my preferred language).</p>
<p>Because nothing is ever easy, there are actually two different python bindings for Qt. There is <a href="https://en.wikipedia.org/wiki/PySide" target="_blank" rel="noopener noreffer">PySide</a> which was created by the Qt Company themselves. It has a less restrictive license, but seems to have less of a community around it due to it being the newer of the two bindings. The other binding is called <a href="https://en.wikipedia.org/wiki/PyQt" target="_blank" rel="noopener noreffer">PyQt</a> and came first, even being called <code>python3-qt</code> in the fedora package manager. When it comes down to coding, there is pretty much no difference between them since they are all just pythonic fronts for the same C++ back-end. For the whole project up until recently I was using PySide since it is the same in every way except for a better license.</p>
<h2 id="python-deployment">Python Deployment</h2>
<p>Python, as it is shipped as CPython, does not (by default) compile to machine code. You&rsquo;ll notice a parenthetical and a subordinate clause in the previous sentence, that&rsquo;s how windy this road goes.</p>
<p>There are systems that will turn your python code into binary executables, I was using <a href="https://www.pyinstaller.org/" target="_blank" rel="noopener noreffer">PyInstaller</a> to get the job done for me. I&rsquo;d run it on Linux, Windows, MacOS and all my code would be packaged in to binary form; there was the issue of non-python dependencies I had but I could find ways around that. So there I was with all my binaries in a row and feeling confident about how I&rsquo;m going to deploy my application.</p>
<h2 id="linux-binary-woes">Linux Binary Woes</h2>
<p>My current main machine runs Fedora Linux, this is a distribution that is kept reasonably up to date and, at the time of writing, has a new desktop environment and newer kernel than other non-Arch distros. All of this meant that when I tried to run my Linux compiled program on Ubuntu (A major distro I want to support), I get thrown an error that Ubuntu doesn&rsquo;t have the correct version of glibc (the dynamically linked C libraries). Sticking with the standard glibc versions that come with each distro, GNU/Linux is backwards compatible but not forwards compatible. That is to say that a program compiled on an older distro will run on a newer distro but not vice-versa. The solution to this seems straightforward doesn&rsquo;t it? Compile the program on an older version. So I loaded up an Ubuntu LTS VM, compile the program, works like a charm. I try to run that same executable on my main Fedora machine and I get an error message:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cmd" data-lang="cmd">Settings schema &#39;org.gnome.settings-daemon.plugins.xsettings&#39;
does not contain a key named &#39;antialiasing&#39;
</code></pre></td></tr></table>
</div>
</div><p>The program does not run. This is without doubt a bug in Gnome 40. But it is a bug that happens 100% of the time, it may get fixed, it may not. My application is either incompatible with anything other than my own machine, or compatible with everything <em>except</em> my own machine. Of course I could have two separate binaries, but that would be a bit of a hassle to maintain. In comes what I thought would be my saviour, Flatpak.</p>
<h3 id="build-systems">Build Systems</h3>
<p>Linux has 3 main methods of deploying applications. Shipping binaries, making per distribution packages, and containers (of which flatpak is one). Binaries are, as we&rsquo;ve seen, version dependent, packages are distribution dependent, and containers run across all machines but have extra bulk since they package there own dependencies rather than relying on system libraries.</p>
<p>Throughout my exploration of deployment options, I have made all three. I have documented my results of binaries, and I also went on to make an RPM package (the packaging system that Fedora uses).</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sh" data-lang="sh">Name:           Pepys
Version:        0.3.0
Release:        8%<span class="o">{</span>?dist<span class="o">}</span>
Summary:        A straightforward markdown journal

License:        GPLv3
URL:            https://www.lukebriggs.dev/pepys
Source0:        pepys.tar.gz

Requires:       python3, python3-wheel, python3-pip, pandoc, enchant, wkhtmltopdf, python3-qt5, python3-qt5-webengine, python3-regex, python3-num2words, python3-pypandoc, python3-enchant, python3-setproctitle, texlive-mdwtools
BuildRequires:  python3-pip
%description

%build
<span class="nv">MAIN_DIR</span><span class="o">=</span>%<span class="o">{</span>buildroot<span class="o">}</span>/usr/share/pepys
<span class="nv">APP_DIR</span><span class="o">=</span>%<span class="o">{</span>buildroot<span class="o">}</span>/usr/local/share/applications
mkdir -p <span class="si">${</span><span class="nv">MAIN_DIR</span><span class="si">}</span>/temp
mkdir -p <span class="si">${</span><span class="nv">APP_DIR</span><span class="si">}</span>

tar -xzvf %<span class="o">{</span>SOURCE0<span class="o">}</span> -C <span class="si">${</span><span class="nv">MAIN_DIR</span><span class="si">}</span>/temp
<span class="k">if</span> <span class="nb">test</span> -f <span class="si">${</span><span class="nv">MAIN_DIR</span><span class="si">}</span>/temp/src/resources/base/config.json<span class="p">;</span> <span class="k">then</span>
rm <span class="si">${</span><span class="nv">MAIN_DIR</span><span class="si">}</span>/temp/src/resources/base/config.json
<span class="k">fi</span>
<span class="k">if</span> <span class="nb">test</span> -f <span class="si">${</span><span class="nv">MAIN_DIR</span><span class="si">}</span>/temp/src/resources/base/wordlist.txt<span class="p">;</span> <span class="k">then</span>
rm <span class="si">${</span><span class="nv">MAIN_DIR</span><span class="si">}</span>/temp/src/resources/base/wordlist.txt<span class="p">;</span>
<span class="k">fi</span>

cp -r <span class="si">${</span><span class="nv">MAIN_DIR</span><span class="si">}</span>/temp/* <span class="si">${</span><span class="nv">MAIN_DIR</span><span class="si">}</span>
rm -rf <span class="si">${</span><span class="nv">MAIN_DIR</span><span class="si">}</span>/temp


<span class="nb">printf</span> <span class="s2">&#34;[Desktop Entry]\n \
</span><span class="s2">Type=Application\n \
</span><span class="s2">Name=Pepys\n \
</span><span class="s2">Categories=Office;\n \
</span><span class="s2">X-GNOME-FullName=Pepys\n \
</span><span class="s2">Comment=A straightforward markdown journal\n \
</span><span class="s2">Icon=%s/src/main/resources/base/icons/appicons/icon.svg\n \
</span><span class="s2">NoDisplay=false\n \
</span><span class="s2">Exec= python3 %s/src/main/python/main.py\n \
</span><span class="s2">Path=\n \
</span><span class="s2">Terminal=false\n \
</span><span class="s2">X-GNOME-UsesNotifications=false\n \
</span><span class="s2">StartupWMClass=Pepys&#34;</span> <span class="s2">&#34;/usr/share/pepys&#34;</span> <span class="s2">&#34;/usr/share/pepys&#34;</span> &gt; <span class="nv">$APP_DIR</span>/Pepys.desktop
pip3 install PyPDF4


%files
/*

%post
chmod -R <span class="m">777</span> /usr/share/pepys

<span class="c1">#%license add-license-file-here</span>
<span class="c1">#%doc add-docs-here</span>



%changelog
* Sat May <span class="m">15</span> <span class="m">2021</span> Luke Briggs &lt;lukebriggs02@gmail.com&gt;
- 
</code></pre></td></tr></table>
</div>
</div><p><strong>NOTICE: The above is a script used for testing, it is mostly functional but don&rsquo;t use it as a guide for how to do things properly</strong></p>
<p>The above is a script you feed into <code>rpmbuild</code> and it will generate a .rpm file which Fedora users can use to install your software. You can see that all it really is is some metadata listing app information, dependencies (these dependencies are ones that are inside the fedora packaging system), and a shell script to say what gets installed and how. Because all the dependencies are listed, and are all from the the distros package manager, the file size of an rpm only consists of the files that you supply. In my case it was some python source files and some vector icons, totalling 1.2MB. Of course the full size of the app still needs to be downloaded but the other 150MB or so come in the form of system libraries that other apps can also use. This is the classic Linux method of software deployment, it is lean, and ensures compatibility with a particular distro. The problem comes when looking at other distributions. Some distributions also use RPM (CentOS, RHEL, OpenSUSE) but have different packages, and so need special cases in the file. Other distributions use a different package management system, Debian and derivatives use .deb files for instance.</p>
<h3 id="flatpak">Flatpak</h3>
<p><a href="https://en.wikipedia.org/wiki/Flatpak" target="_blank" rel="noopener noreffer">Flatpak</a> and it&rsquo;s rival <a href="https://en.wikipedia.org/wiki/Snap_%28package_manager%29" target="_blank" rel="noopener noreffer">Snap</a> aim to solve the dependency hell by shipping everything together in one big package. You avoid incompatibility at the cost of redundancy. The cover image of this post is my flatpak spec file that gets fed into <code>flatpak-builder</code>. And you may notice that it works in a similar way to a distribution&rsquo;s own package manager.</p>
<p>We have metadata along with base dependencies</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">app-id</span><span class="p">:</span><span class="w"> </span><span class="l">dev.lukebriggs.pepys</span><span class="w">
</span><span class="w"></span><span class="nt">runtime</span><span class="p">:</span><span class="w"> </span><span class="l">org.kde.Platform</span><span class="w">
</span><span class="w"></span><span class="nt">runtime-version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;5.15&#39;</span><span class="w">
</span><span class="w"></span><span class="nt">sdk</span><span class="p">:</span><span class="w"> </span><span class="l">org.kde.Sdk</span><span class="w">
</span><span class="w"></span><span class="nt">add-extensions</span><span class="p">:</span><span class="w">
</span><span class="w">  </span><span class="nt">org.freedesktop.Sdk.Extension.texlive</span><span class="p">:</span><span class="w">
</span><span class="w">    </span><span class="nt">directory</span><span class="p">:</span><span class="w"> </span><span class="l">texlive</span><span class="w">
</span><span class="w">    </span><span class="nt">subdirectories</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">autodelete</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="w">    </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;20.08&#39;</span><span class="w">
</span><span class="w"></span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">runner.sh</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>Because everything is in a sandbox, we have to declare what parts of the host system we have to use</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="nt">finish-args</span><span class="p">:</span><span class="w">
</span><span class="w">  </span>- --<span class="l">share=ipc</span><span class="w">
</span><span class="w">  </span>- --<span class="l">socket=x11</span><span class="w">
</span><span class="w">  </span>- --<span class="l">socket=wayland</span><span class="w">
</span><span class="w">  </span>- --<span class="l">socket=pulseaudio</span><span class="w">
</span><span class="w">  </span>- --<span class="l">device=dri</span><span class="w">
</span><span class="w">  </span>- --<span class="l">filesystem=home</span><span class="w">
</span><span class="w">  </span>- --<span class="l">share=network</span><span class="w">
</span><span class="w">  </span>- --<span class="l">env=PATH=/usr/bin:/app/bin:/app/texlive/bin:/app/texlive/bin/x86_64-linux:/app/texlive/bin/aarch64-linux</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>And then comes the rest of our dependencies which have to be files we supply, along with the build script we use to actually do what we want with the files.</p>
<h4 id="the-trouble-with-python-qt-and-flatpak">The Trouble with Python, Qt and Flatpak</h4>
<p>All was going swimmingly until I had to get my Qt app in flatpak.
2 of my app dependencies are installed by effectively copying the prebuild binaries into the flatpak sandbox.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pandoc</span><span class="w">
</span><span class="w">    </span><span class="nt">buildsystem</span><span class="p">:</span><span class="w"> </span><span class="l">simple</span><span class="w">
</span><span class="w">    </span><span class="nt">build-commands</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">ls</span><span class="w">
</span><span class="w">      </span>- <span class="l">install -D bin/pandoc /app/bin/pandoc</span><span class="w">
</span><span class="w">    </span><span class="nt">sources</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">archive</span><span class="w">
</span><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">https://github.com/jgm/pandoc/releases/download/2.13/pandoc-2.13-linux-amd64.tar.gz</span><span class="w">
</span><span class="w">        </span><span class="nt">sha256</span><span class="p">:</span><span class="w"> </span><span class="l">7404aa88a6eb9fbb99d9803b80170a3a546f51959230cc529c66a2ce6b950d4c</span><span class="w">
</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">wkhtmltopdf</span><span class="w">
</span><span class="w">    </span><span class="nt">buildsystem</span><span class="p">:</span><span class="w"> </span><span class="l">simple</span><span class="w">
</span><span class="w">    </span><span class="nt">build-commands</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">cp -r local/* /app/</span><span class="w">
</span><span class="w">      </span>- <span class="l">ls lib</span><span class="w">
</span><span class="w">    </span><span class="nt">sources</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">archive</span><span class="w">
</span><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6-1/wkhtmltox-0.12.6-1.centos8.x86_64.rpm</span><span class="w">
</span><span class="w">        </span><span class="nt">sha256</span><span class="p">:</span><span class="w"> </span><span class="l">5cc267d54fe3f144729f31432a165e028b689583c53cfee0a01d52644ab280d9</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>One of my dependencies is actually built and compiled within the flatpak container. (Given no <code>buildsystem</code> option on archives with makefiles in them, flatpak will automatically compile and install them)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">  - name: enchant
    sources:
      - type: archive
        url: https://github.com/AbiWord/enchant/releases/download/v2.2.15/enchant-2.2.15.tar.gz
        sha256: 3b0f2215578115f28e2a6aa549b35128600394304bd79d6f28b0d3b3d6f46c03
</code></pre></td></tr></table>
</div>
</div><p>So we are back to the dilemma of using source files or prebuilt binaries, you&rsquo;ll see later that the solution is a mix of both.</p>
<p>One option is just shipping a compiled version of my program in a flatpak. The issue is that flatpak&rsquo;s glibc is once again older than my main machine so <em>all</em> flatpak builds would have to be done in an Ubuntu VM, not ideal. Next up comes building from source in the flatpak. My plan for the process was this:</p>
<ol>
<li>Get python and resource files in the flatpak</li>
<li><code>pip install</code> all dependencies</li>
</ol>
<p>Sounds simple enough, but flatpak didn&rsquo;t like me communicating with the internet while installing (I tried <code>share=network</code> on individual modules and it didn&rsquo;t work)
So, each python library had to be down as it&rsquo;s own python module with a link to the tar balls on pypi. Flatpak has a tool for such an occasion called <a href="https://github.com/flatpak/flatpak-builder-tools/tree/master/pip" target="_blank" rel="noopener noreffer">flatpak-pip-generator</a>
so the line in the flatpak yml</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml">- <span class="l">python3-requirements.json</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>is a pointer to a file actually containing all pip dependencies</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;python3-requirements&#34;</span><span class="p">,</span>
    <span class="nt">&#34;buildsystem&#34;</span><span class="p">:</span> <span class="s2">&#34;simple&#34;</span><span class="p">,</span>
    <span class="nt">&#34;build-commands&#34;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="nt">&#34;modules&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;python3-regex&#34;</span><span class="p">,</span>
            <span class="nt">&#34;buildsystem&#34;</span><span class="p">:</span> <span class="s2">&#34;simple&#34;</span><span class="p">,</span>
            <span class="nt">&#34;build-commands&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;pip3 install --verbose --exists-action=i --no-index --find-links=\&#34;file://${PWD}\&#34; --prefix=${FLATPAK_DEST} \&#34;regex\&#34; --no-build-isolation&#34;</span>
            <span class="p">],</span>
            <span class="nt">&#34;sources&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://files.pythonhosted.org/packages/38/3f/4c42a98c9ad7d08c16e7d23b2194a0e4f3b2914662da8bc88986e4e6de1f/regex-2021.4.4.tar.gz&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;sha256&#34;</span><span class="p">:</span> <span class="s2">&#34;52ba3d3f9b942c49d7e4bc105bb28551c44065f139a65062ab7912bef10c9afb&#34;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;python3-num2words&#34;</span><span class="p">,</span>
            <span class="nt">&#34;buildsystem&#34;</span><span class="p">:</span> <span class="s2">&#34;simple&#34;</span><span class="p">,</span>
            <span class="nt">&#34;build-commands&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;pip3 install --verbose --exists-action=i --no-index --find-links=\&#34;file://${PWD}\&#34; --prefix=${FLATPAK_DEST} \&#34;num2words\&#34; --no-build-isolation&#34;</span>
            <span class="p">],</span>
            <span class="nt">&#34;sources&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://files.pythonhosted.org/packages/a2/55/8f8cab2afd404cf578136ef2cc5dfb50baa1761b68c9da1fb1e4eed343c9/docopt-0.6.2.tar.gz&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;sha256&#34;</span><span class="p">:</span> <span class="s2">&#34;49b3a825280bd66b3aa83585ef59c4a8c82f2c8a522dbe754a8bc8d08c85c491&#34;</span>
                <span class="p">},</span>
                <span class="p">{</span>
                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://files.pythonhosted.org/packages/33/db/76f1151a1b0cfad532d41021b77cd231495bf72c47618166f92dcdff2ebe/num2words-0.5.10.tar.gz&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;sha256&#34;</span><span class="p">:</span> <span class="s2">&#34;37cd4f60678f7e1045cdc3adf6acf93c8b41bf732da860f97d301f04e611cc57&#34;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;python3-pypandoc&#34;</span><span class="p">,</span>
            <span class="nt">&#34;buildsystem&#34;</span><span class="p">:</span> <span class="s2">&#34;simple&#34;</span><span class="p">,</span>
            <span class="nt">&#34;build-commands&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;pip3 install --verbose --exists-action=i --no-index --find-links=\&#34;file://${PWD}\&#34; --prefix=${FLATPAK_DEST} \&#34;wheel\&#34; --no-build-isolation&#34;</span><span class="p">,</span>
                <span class="s2">&#34;pip3 install --verbose --exists-action=i --no-index --find-links=\&#34;file://${PWD}\&#34; --prefix=${FLATPAK_DEST} \&#34;pypandoc\&#34; --no-build-isolation&#34;</span>
            <span class="p">],</span>
            <span class="nt">&#34;sources&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://files.pythonhosted.org/packages/ed/46/e298a50dde405e1c202e316fa6a3015ff9288423661d7ea5e8f22f589071/wheel-0.36.2.tar.gz&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;sha256&#34;</span><span class="p">:</span> <span class="s2">&#34;e11eefd162658ea59a60a0f6c7d493a7190ea4b9a85e335b33489d9f17e0245e&#34;</span>
                <span class="p">},</span>

                <span class="p">{</span>
                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://files.pythonhosted.org/packages/d6/b7/5050dc1769c8a93d3ec7c4bd55be161991c94b8b235f88bf7c764449e708/pypandoc-1.5.tar.gz&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;sha256&#34;</span><span class="p">:</span> <span class="s2">&#34;14a49977ab1fbc9b14ef3087dcb101f336851837fca55ca79cf33846cc4976ff&#34;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;python3-pyenchant&#34;</span><span class="p">,</span>
            <span class="nt">&#34;buildsystem&#34;</span><span class="p">:</span> <span class="s2">&#34;simple&#34;</span><span class="p">,</span>
            <span class="nt">&#34;build-commands&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;pip3 install --verbose --exists-action=i --no-index --find-links=\&#34;file://${PWD}\&#34; --prefix=${FLATPAK_DEST} \&#34;pyenchant\&#34; --no-build-isolation&#34;</span>
            <span class="p">],</span>
            <span class="nt">&#34;sources&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://files.pythonhosted.org/packages/1f/d4/52869fe4ed24e373694c116adc00c82e5d92c747be4cbc97b24af43807f6/pyenchant-3.2.0.tar.gz&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;sha256&#34;</span><span class="p">:</span> <span class="s2">&#34;6b97e9a9f132fa7c9029a6635d821ccad67d4980e68186d02c765b4256b6f152&#34;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;python3-PyPDF4&#34;</span><span class="p">,</span>
            <span class="nt">&#34;buildsystem&#34;</span><span class="p">:</span> <span class="s2">&#34;simple&#34;</span><span class="p">,</span>
            <span class="nt">&#34;build-commands&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;pip3 install --verbose --exists-action=i --no-index --find-links=\&#34;file://${PWD}\&#34; --prefix=${FLATPAK_DEST} \&#34;PyPDF4\&#34; --no-build-isolation&#34;</span>
            <span class="p">],</span>
            <span class="nt">&#34;sources&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://files.pythonhosted.org/packages/4f/1f/509b44850c475c101aa5b5c9b81755cedd363389d6fbb5c53be6fa915a61/PyPDF4-1.27.0.tar.gz&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;sha256&#34;</span><span class="p">:</span> <span class="s2">&#34;7c932441146d205572f96254d53c79ea2c30c9e11df55a5cf87e056c7b3d7f89&#34;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;python3-setproctitle&#34;</span><span class="p">,</span>
            <span class="nt">&#34;buildsystem&#34;</span><span class="p">:</span> <span class="s2">&#34;simple&#34;</span><span class="p">,</span>
            <span class="nt">&#34;build-commands&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s2">&#34;pip3 install --verbose --exists-action=i --no-index --find-links=\&#34;file://${PWD}\&#34; --prefix=${FLATPAK_DEST} \&#34;setproctitle\&#34; --no-build-isolation&#34;</span>
            <span class="p">],</span>
            <span class="nt">&#34;sources&#34;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;file&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;url&#34;</span><span class="p">:</span> <span class="s2">&#34;https://files.pythonhosted.org/packages/a1/7f/a1d4f4c7b66f0fc02f35dc5c85f45a8b4e4a7988357a29e61c14e725ef86/setproctitle-1.2.2.tar.gz&#34;</span><span class="p">,</span>
                    <span class="nt">&#34;sha256&#34;</span><span class="p">:</span> <span class="s2">&#34;7dfb472c8852403d34007e01d6e3c68c57eb66433fb8a5c77b13b89a160d97df&#34;</span>
                <span class="p">}</span>
            <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>You&rsquo;ll notice that there is no mention of PySide or Qt. The <em>key</em> module that the app depends so heavily is not there, why? Well because both Qt python dependencies are not available as source files from pip. Pip hosts source files and wheels. All the above are source files. These are tar balls that pip will compile and build from source. Wheels are, once again, pre-built binaries. Flatpak doesn&rsquo;t include wheels by default since it wants everything to be as cross platform and cross architecture as possible.</p>
<p>I also wanted to be as platform agnostic as possible so I attempted to build my python bindings from source in the flatpak. Flatpak did not like this. Neither PySide nor PyQt would build and each threw different error during the compilation process. My best guess would by the sandbox does not contain some required system libraries but I am at a loss to know which ones. And C compilers are not the most helpful thing as your only point of reference for a system error.</p>
<h3 id="lasers-to-the-rescue">Lasers to the rescue</h3>
<p>At this stage, I didn&rsquo;t actually know what python wheels were, I just assumed everything had to be built from source. I was desperate for answers after 3 days of debugging and staring at config files. I did something I very rarely do, I used the GitHub search function. To my amazement I found a solution.</p>
<p>The <a href="https://www.physics.hu-berlin.de/en/qom" target="_blank" rel="noopener noreffer">Optical Metrology Group</a> in the Physics department of Humboldt University Berlin <a href="https://github.com/hermitdemschoenenleben/linien" target="_blank" rel="noopener noreffer">created a Linux application for locking onto spectroscopy lines</a>. Guess what, they made a flatpak!</p>
<p>I looked at there yaml, and I knew then and there that they had found a solution.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-yaml" data-lang="yaml"><span class="w">  </span><span class="c"># we used to build pyqt on our own here, but this build caused trouble with the pyqtgraph widget being transparent on some systems.</span><span class="w">
</span><span class="w">  </span><span class="c"># Therefore, we just use the x86_64 wheel here...</span><span class="w">
</span><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">pyqt-x86_64</span><span class="w">
</span><span class="w">    </span><span class="nt">buildsystem</span><span class="p">:</span><span class="w"> </span><span class="l">simple</span><span class="w">
</span><span class="w">    </span><span class="nt">sources</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">file</span><span class="w">
</span><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">https://files.pythonhosted.org/packages/4c/bb/7fce18fbe0275d7a3e069a306d8f4662c77eda30ec6780634fd4a7ee50ce/PyQt5-5.15.1-5.15.1-cp35.cp36.cp37.cp38.cp39-abi3-manylinux2014_x86_64.whl</span><span class="w">
</span><span class="w">        </span><span class="nt">sha256</span><span class="p">:</span><span class="w"> </span><span class="l">b1ea7e82004dc7b311d1e29df2f276461016e2d180e10c73805ace4376125ed9</span><span class="w">
</span><span class="w">      </span>- <span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">file</span><span class="w">
</span><span class="w">        </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l">https://files.pythonhosted.org/packages/31/24/f887203677955ba4d5d4efe9176ac7ed2bf84efce8c243ab91e63183ad9e/PyQt5_sip-12.8.1-cp37-cp37m-manylinux1_x86_64.whl</span><span class="w">
</span><span class="w">        </span><span class="nt">sha256</span><span class="p">:</span><span class="w"> </span><span class="l">a1b8ef013086e224b8e86c93f880f776d01b59195bdfa2a8e0b23f0480678fec</span><span class="w">
</span><span class="w">    </span><span class="nt">build-commands</span><span class="p">:</span><span class="w">
</span><span class="w">      </span>- <span class="l">pip3 install PyQt*.whl --target=/app/lib/python3.7/site-packages</span><span class="w">
</span></code></pre></td></tr></table>
</div>
</div><p>They had obviously also faced similar Qt-based problems. Their YAML led to me finding out about python wheels, how I could get PyQt in a flatpak, and how I could tell pip the right directory for a python installation (I had no idea what <code>--target</code> would do before this).</p>
<p>Thanks to some German physicists, my next project is back on track. Beady eyed people may notice some information in some of the config files I&rsquo;ve posted that hint to what it could be. I did try and use PySide using the same wheel method but I got into some strange cyclical versioning thing since it required PySide an Shiboken2 to be installed at the same time. All that means is that my application will be open source out of a legal obligation, as well as an civil one.</p>
<p><em>SIDE:</em> kerberos is also a requirement for PyQt to work in a flatpak, I have no idea why but it may have something to do with certain networking modules.</p>
<h2 id="further-reading">Further Reading</h2>
<p>Here are some useful sources of information I turned to while interacting with packaging systems on Linux</p>
<dl>
<dt><a href="https://www.loganasherjones.com/2018/05/using-flatpak-with-python/">https://www.loganasherjones.com/2018/05/using-flatpak-with-python/</a></dt>
<dd>An excellent and succinct guide that covers making non-qt python apps work in a flatpak</dd>
<dt><a href="https://docs.flatpak.org/en/latest/getting-started.html">https://docs.flatpak.org/en/latest/getting-started.html</a></dt>
<dd>Information on what a flatpak is and what its parts consist of.</dd>
<dt><a href="https://docs.flatpak.org/en/latest/flatpak-builder-command-reference.html">https://docs.flatpak.org/en/latest/flatpak-builder-command-reference.html</a></dt>
<dd>A good reference for what commands can be used in flatpak YAML</dd>
<dt><a href="https://github.com/flathub/io.github.hermitdemschoenenleben.linien/blob/8d89b1c7193602f0696f134e92ac1eba39986303/io.github.hermitdemschoenenleben.linien.yml#L18">https://github.com/flathub/io.github.hermitdemschoenenleben.linien/blob/8d89b1c7193602f0696f134e92ac1eba39986303/io.github.hermitdemschoenenleben.linien.yml#L18</a></dt>
<dd>The Humboldt University Berlin YAML</dd>
<dt><a href="https://opensource.com/article/18/9/how-build-rpm-packages">https://opensource.com/article/18/9/how-build-rpm-packages</a></dt>
<dd>A straightforward guide on how to make RPM packages</dd>
</dl>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-05-22</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/flatpak-instructions-not-included/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://www.lukebriggs.dev/flatpak-instructions-not-included/" data-title="Flatpak: Instructions Not Included" data-via="LukeBriggsDev"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://www.lukebriggs.dev/flatpak-instructions-not-included/"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on WhatsApp" data-sharer="whatsapp" data-url="https://www.lukebriggs.dev/flatpak-instructions-not-included/" data-title="Flatpak: Instructions Not Included" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="https://www.lukebriggs.dev/flatpak-instructions-not-included/" data-title="Flatpak: Instructions Not Included"><i data-svg-src="/lib/simple-icons/icons/line.min.svg"></i></a><a href="javascript:void(0);" title="Share on " data-sharer="weibo" data-url="https://www.lukebriggs.dev/flatpak-instructions-not-included/" data-title="Flatpak: Instructions Not Included" data-image="/static/postimages/flatpak-instructions-not-included/flatpak.svg"><i class="fab fa-weibo fa-fw"></i></a><a href="javascript:void(0);" title="Share on Myspace" data-sharer="myspace" data-url="https://www.lukebriggs.dev/flatpak-instructions-not-included/" data-title="Flatpak: Instructions Not Included" data-description="How German Laser Beams Fixed My App"><i data-svg-src="/lib/simple-icons/icons/myspace.min.svg"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="https://www.lukebriggs.dev/flatpak-instructions-not-included/" data-title="Flatpak: Instructions Not Included" data-description="How German Laser Beams Fixed My App"><i class="fab fa-blogger fa-fw"></i></a><a href="javascript:void(0);" title="Share on Evernote" data-sharer="evernote" data-url="https://www.lukebriggs.dev/flatpak-instructions-not-included/" data-title="Flatpak: Instructions Not Included"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/where-hugo-i-go/" class="prev" rel="prev" title="Where Hugo I Go"><i class="fas fa-angle-left fa-fw"></i>Where Hugo I Go</a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.80.0">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Luke Briggs</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/katex/copy-tex.min.css"><script type="text/javascript" src="/lib/smooth-scroll/smooth-scroll.min.js"></script><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":10},"comment":{},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":30,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
